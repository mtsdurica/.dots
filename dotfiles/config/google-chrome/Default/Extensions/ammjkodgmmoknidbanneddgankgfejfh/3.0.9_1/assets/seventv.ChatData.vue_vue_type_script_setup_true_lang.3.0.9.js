import{u as G}from"./seventv.main.3.0.9.js";import{C as M}from"./seventv.ChatMessage.3.0.9.js";import{e as q,l as d,f as i,j as l,k as S,u as g,F as T,m as O,x as Q,y as $,z,_ as H,aI as R,R as V,a4 as K,Q as Z}from"./seventv.index.3.0.9.js";import{u as P}from"./seventv.useChannelContext.3.0.9.js";import{u as J}from"./seventv.useChatEmotes.3.0.9.js";import{u as W}from"./seventv.UiConfirmPrompt.3.0.9.js";import{D as X}from"./seventv.useCosmetics.3.0.9.js";import{_ as Y}from"./seventv.StarIcon.3.0.9.js";import{E as A}from"./seventv.Emote.3.0.9.js";import{j as x}from"./seventv.UserTag.3.0.9.js";import{u as ee,t as f,a9 as te,r as se}from"./seventv.useUserAgent.3.0.9.js";import{v as b}from"./seventv.v4.3.0.9.js";const N=y=>($("data-v-4705bced"),y=y(),z(),y),oe={class:"seventv-emote-set-update-message-container"},ne={class:"seventv-logo"},ae={key:0,class:"seventv-author"},re={class:"seventv-change-detail"},de=N(()=>l("span",null,"switched the active emote set from ",-1)),ie=N(()=>l("span",null," to ",-1)),me={key:1},ce={key:2},pe={key:3},le={key:4},ue={key:5},_e={key:6},fe=N(()=>l("span",null,"changed the name of ",-1)),ve={class:"referenced-emote"},he=N(()=>l("span",null,"to ",-1)),ge={class:"referenced-emote"},ye=q({__name:"EmoteSetUpdateMessage",props:{appUser:{},add:{},remove:{},update:{},wholeSet:{}},setup(y){var I,k;const u=y,_=P(),{chatters:B}=W(_),m=(I=u.appUser.connections)==null?void 0:I.find(s=>s.platform==="TWITCH"),e=(m?B[m.id]:null)??{id:(m==null?void 0:m.id)??u.appUser.id,displayName:(m==null?void 0:m.display_name)??u.appUser.display_name,username:(m==null?void 0:m.username)??u.appUser.username,color:(k=u.appUser.style)!=null&&k.color?X(u.appUser.style.color):"inherit"};return(s,D)=>(d(),i("span",oe,[l("span",ne,[S(Y,{provider:"7TV"})]),s.appUser?(d(),i("span",ae,[S(x,{user:ee(e)},null,8,["user"])])):g("",!0),l("span",re,[s.wholeSet&&s.wholeSet.length===2?(d(),i(T,{key:0},[de,l("strong",null,f(s.wholeSet[0].name),1),ie,l("strong",null,f(s.wholeSet[1].name),1)],64)):g("",!0),s.add.length>1?(d(),i("span",me,"added "+f(s.add.length)+" emotes ",1)):s.add.length?(d(),i("span",ce,"added ")):g("",!0),(d(!0),i(T,null,O(s.add,c=>(d(),i("span",{key:c.id,class:"referenced-emote"},[S(A,{emote:c},null,8,["emote"]),Q(" "+f(c.name),1)]))),128)),s.add.length&&s.remove.length?(d(),i("span",pe," and ")):g("",!0),s.remove.length>1?(d(),i("span",le,"removed "+f(s.remove.length)+" emotes ",1)):s.remove.length?(d(),i("span",ue,"removed ")):g("",!0),(d(!0),i(T,null,O(s.remove,c=>(d(),i("span",{key:c.id,class:"referenced-emote"},[S(A,{emote:c},null,8,["emote"]),l("span",null,f(c.name),1)]))),128)),(s.add.length||s.remove.length)&&s.update.length?(d(),i("span",_e," and ")):g("",!0),(d(!0),i(T,null,O(s.update,([c,o])=>(d(),i(T,{key:o.id+c.id},[o.name!==c.name?(d(),i(T,{key:0},[fe,l("span",ve,[S(A,{emote:o},null,8,["emote"]),l("span",null,f(c.name),1)]),he,l("span",ge,[l("span",null,f(o.name),1)])],64)):g("",!0)],64))),128))])]))}});const j=H(ye,[["__scopeId","data-v-4705bced"]]),Oe=q({__name:"ChatData",setup(y){const{target:u}=Z(),_=P(),B=te(_,"id"),m=W(_),e=J(_),{providers:I}=G(),k=R(()=>V.channels.where("id").equals(_.id).first().then(o=>(o==null?void 0:o.set_ids)??[]),void 0,{reactives:[B]});R(()=>V.emoteSets.where("id").anyOf(k.value??[]).or("scope").equals("GLOBAL").sortBy("priority"),o=>{if(e.providers["7TV"]={},e.providers.FFZ={},e.providers.BTTV={},!o)return;for(const t of o){if(!t.provider||!I.has(t.provider))continue;const n=t.provider??"UNKNOWN";e.providers[n]||(e.providers[n]={}),e.providers[n][t.id]=t,e.sets[t.id]=t}const a={};for(const t of o.flatMap(n=>n.emotes)){if(!t)return;a[t.name]=t}for(const t in e.emojis){const n=e.emojis[t];!n||!n.unicode||(a[n.unicode]=n)}for(const t in a)e.active[t]=a[t]},{reactives:[k]});function s(o){var L;const{id:a,emotes_added:t,emotes_removed:n,emotes_updated:v,user:F}=o.detail;if(!((L=k.value)!=null&&L.includes(a)))return;const U=e.sets[a];for(const r of t)e.active[r.name]=r,e.sets[a]&&U.emotes.push(r);for(const[r,p]of v){if(!p||!r)continue;const w=e.find(h=>h.id===p.id,!0);if(!w)continue;const E=se(w);for(const h in p)h!=="data"&&(E.value={...E.value,[h]:p[h]});delete e.active[r.name],e.active[p.name]=E.value}for(let r=0;r<n.length;r++){const p=n[r],w=e.active[p.name];if(!(!w||w.id!==p.id)&&(n[r].data=w.data,delete e.active[p.name],e.sets[a])){const E=U.emotes.findIndex(h=>h.id===p.id);E!==-1&&U.emotes.splice(E,1)}}const C=new M(b());C.setComponent(j,{appUser:F,add:t,remove:n,update:v}),m.add(C)}function D(o,a,t,n){var C,L;if(!a||!_.user)return;const v=(C=_.user.connections)==null?void 0:C[o];if(!v||v.emote_set&&v.emote_set.id!==a.id)return;const F=((L=e.sets[a.id])==null?void 0:L.emotes)??[];for(const r of F)delete e.active[r.name];delete e.sets[a.id],v.emote_set=t,V.channels.where("id").equals(_.id??"").modify(r=>{const p=r.set_ids.indexOf(a.id);p!==-1?r.set_ids.splice(p,1,t.id):r.set_ids.push(t.id)});const U=new M(b());U.setComponent(j,{appUser:n,add:[],remove:[],update:[],wholeSet:[a,t]}),m.add(U)}function c(o){e.providers.PLATFORM||(e.providers.PLATFORM={}),e.providers.PLATFORM[o.detail.id]=o.detail}return u.addEventListener("emote_set_updated",s),u.addEventListener("user_updated",o=>{const{id:a,actor:t,emote_set:n}=o.detail;!a||!n||D(n.connection_index,n.old_set,n.new_set,t)}),u.addEventListener("twitch_emote_set_data",c),K(()=>{u.removeEventListener("emote_set_updated",s),u.removeEventListener("twitch_emote_set_data",c)}),(o,a)=>null}});export{Oe as _,j as a};
