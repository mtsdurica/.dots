import{e as I,ar as H,al as R,a as U,a4 as P,ak as A,l as g,f as v,F as b,m as L,s as T,j as V,k as j,Z as F,u as B,ao as G,_ as K,G as $,i as Y,ag as z,ax as X,am as Z,aj as q}from"./seventv.index.3.0.9.js";import{R as J,u as N}from"./seventv.ReactHooks.3.0.9.js";import{d as Q}from"./seventv.useModule.3.0.9.js";import{r as D,l as W,t as ee,u,a as te}from"./seventv.useUserAgent.3.0.9.js";import{c as oe,a as se}from"./seventv.Transform.3.0.9.js";import{C as ne,M as y}from"./seventv.ChatMessage.3.0.9.js";import{u as re}from"./seventv.useChannelContext.3.0.9.js";import{u as ae}from"./seventv.useChatEmotes.3.0.9.js";import{u as ce,U as ie}from"./seventv.UserTag.3.0.9.js";import{_ as le}from"./seventv.ChatData.vue_vue_type_script_setup_true_lang.3.0.9.js";import{i as pe}from"./seventv.index.3.0.94.js";const me={class:"seventv-chat-vod-message-wrapper"},ue={class:"seventv-chat-vod-message-timestamp"},de=I({__name:"ChatVod",props:{list:{},controller:{}},setup(M){const i=M,d=re(void 0,!0),h=ae(d),a=ce(d),f=D([]);H(i.controller.component,"props",{value(e){var n,l;const{owner:o}=e.data.video??{},s=e.data.badges;let t=null;if(o&&(d.setCurrentChannel({id:o.id,username:o.login,displayName:o.login,active:!0}),t=o.broadcastBadges),e.data.badges&&!((n=a.twitchBadgeSets)!=null&&n.globalsBySet)&&!((l=a.twitchBadgeSets)!=null&&l.channelsBySet)){a.twitchBadgeSets={globalsBySet:new Map,channelsBySet:new Map,count:0};for(const p of[...s,...t??[]]){let m=a.twitchBadgeSets.globalsBySet.get(p.setID);m||(m=new Map,a.twitchBadgeSets.globalsBySet.set(p.setID,m),a.twitchBadgeSets.count++),m.set(p.version,p)}}e.canCurrentUserBan||e.canCurrentUserDelete?(d.actor.roles.add("MODERATOR"),a.showModerationIcons=!0):d.actor.roles.delete("MODERATOR")}}),R(i.list.component,"render",function(e){const o=e==null?void 0:e.apply(this);let t=o.props.children,n=0;for(;!(n++>25);)if(Array.isArray(t)?t=t[0]:t&&(t=t.props.children),t&&!Array.isArray(t)&&t.type==="ul"){t.props.children=c(t.props.children);break}return o}),U(f.value,()=>{!i.list.component||typeof i.list.component.componentDidUpdate!="function"||i.list.component.componentDidUpdate(i.list.component.props,i.list.component.state)});function E(e){return e&&e.badgeSets&&e.canCurrentUserBan!==void 0&&e.canCurrentUserDelete!==void 0&&e.messageContext&&e.messageContext.author&&e.messageContext.comment&&e.messageContext.lastUpdated}function c(e){var s,t;const o=[];f.value.length=0;for(let n=0;n<e.length;n++){const l=e[n];if(!l)continue;const p=l.props;if(!p)continue;const m=p.children;if(!m)continue;const k=(t=(s=m.props)==null?void 0:s.children)==null?void 0:t.props;if(!E(k))continue;const _=S(k);l.props.children=_.element,o[n]=l,f.value[n]={current:te(_.element.ref),msg:_.msg,timestamp:_.timestamp}}return o}function S(e){var _,x,w,O;const o=D({current:null}),s=e.messageContext.comment,t=new ne(e.messageContext.comment.id);e.messageContext.author&&(t.setAuthor({id:e.messageContext.author.id,username:e.messageContext.author.name??"",displayName:e.messageContext.author.displayName??"",color:s.message.userColor}),t.badges=s.userBadges);for(const C of s.message.tokens)switch(C.type){case y.EMOTE:{const r=C.content;if(!r.alt)continue;t.nativeEmotes[r.alt+(r.cheerAmount??"")]={id:r.emoteID??"",name:r.alt,flags:0,provider:"PLATFORM",isTwitchCheer:{amount:r.cheerAmount,color:r.cheerColor},data:r.cheerAmount?oe({alt:r.alt,cheerAmount:r.cheerAmount,cheerColor:r.cheerColor,images:r.images}):se({id:r.emoteID,token:r.alt})},t.body+=r.alt;break}case y.MENTION:t.body+=`@${C.content.recipient}`;break;case y.TEXT:case y.CURRENTUSERHIGHLIGHT:t.body+=C.content;break;case y.LINK:case y.CLIPLINK:case y.VIDEOLINK:t.body+=C.content.url;break}const n=pe({start:0,end:s.contentOffset*1e3}),l=n.days?(_=n.days)==null?void 0:_.toString().padStart(2,"0"):"",p=n.hours?(x=n.hours)==null?void 0:x.toString().padStart(2,"0"):l?"00":"",m=((w=n.minutes)==null?void 0:w.toString().padStart(2,"0"))??"00",k=((O=n.seconds)==null?void 0:O.toString().padStart(2,"0"))??"00";return{element:{[G]:J,key:null,ref:o.value,type:"div",props:{className:"seventv-chat-vod-message-patched"}},msg:t,timestamp:[l,p,m,k].filter(C=>C).join(":")}}return P(()=>{A(i.controller.component,"props"),A(i.list.component,"render"),W.debug("<Chat/Vod> Unmounted")}),(e,o)=>(g(),v(b,null,[(g(!0),v(b,null,L(f.value,s=>(g(),v(b,{key:s.msg.id},[s&&s.current.current?(g(),T(F,{key:0,to:s.current.current},[V("div",me,[V("span",ue,ee(s.timestamp),1),j(ie,{msg:s.msg,emotes:u(h).active},null,8,["msg","emotes"])])],8,["to"])):B("",!0)],64))),128)),u(d).loaded?(g(),T(le,{key:0})):B("",!0)],64))}});const he=K(de,[["__scopeId","data-v-00f66403"]]),ge=[q("chat.vods","TOGGLE",{label:"VOD Support",path:["Chat","VODs"],hint:"Enables 7TV rendering in the chat replay of VODs",defaultValue:!0})],fe=I({__name:"ChatVodModule",setup(M){Q("chat-vod",{name:"Chat VOD",depends_on:[]});const i=$("chat.vods"),d=Y(z)??D(""),h=N({parentSelector:".video-chat",maxDepth:20,predicate:c=>c.props&&c.props.children&&c.props.onScrollBottom}),a=N({parentSelector:".chat-shell",maxDepth:20,predicate:c=>c.props&&c.props.comments&&typeof c.props.currentVideoTime=="number"},{trackRoot:!0}),f=D(!1),E=X(f,100);return U(()=>[a.instances,h.instances],([c,S])=>{f.value=c.length===S.length},{immediate:!0}),Z(d,()=>{a.instances.length&&h.instances.length||(a.retry(),h.retry())},{debounce:1e3}),(c,S)=>(g(!0),v(b,null,L(u(h).instances,(e,o)=>(g(),v(b,{key:o},[u(E)&&u(i)&&u(h).instances[o]&&u(a).instances[o]?(g(),T(he,{key:0,list:u(h).instances[o],controller:u(a).instances[o]},null,8,["list","controller"])):B("",!0)],64))),128))}}),Me=Object.freeze(Object.defineProperty({__proto__:null,config:ge,default:fe},Symbol.toStringTag,{value:"Module"}));export{Me as _};
