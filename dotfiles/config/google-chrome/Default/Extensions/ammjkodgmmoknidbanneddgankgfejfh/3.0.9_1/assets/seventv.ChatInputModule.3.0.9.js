import{u as me}from"./seventv.ReactHooks.3.0.9.js";import{g as Ee,a as Ae,d as Oe}from"./seventv.useModule.3.0.9.js";import{_ as ie,l as _,f as S,j as U,e as K,G as x,w as Ie,s as R,q as re,k as F,F as G,m as Q,u as L,a as ye,ap as de,aq as Le,al as se,ar as $e,a4 as ve,ak as V,ao as j,as as Pe,at as De,Z as Ne,au as Ge,av as Re,aw as Ue,aj as D}from"./seventv.index.3.0.9.js";import{u as We,a as He}from"./seventv.index.3.0.93.js";import{u as Be}from"./seventv.main.3.0.9.js";import{i as Ve}from"./seventv.Transform.3.0.9.js";import{u as je}from"./seventv.useChannelContext.3.0.9.js";import{u as Fe}from"./seventv.useChatEmotes.3.0.9.js";import{u as Ke,U as ze}from"./seventv.UiConfirmPrompt.3.0.9.js";import{u as Je}from"./seventv.useCosmetics.3.0.9.js";import{r as E,u as X,c as qe,t as Qe,a9 as Xe,a as Ye}from"./seventv.useUserAgent.3.0.9.js";import{E as ae}from"./seventv.Emote.3.0.9.js";import{U as Ze}from"./seventv.UiFloating.3.0.9.js";import{a as et}from"./seventv.useFloatContext.3.0.9.js";import{_ as tt}from"./seventv.StarIcon.3.0.9.js";const ot={},nt={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512",width:"1em",height:"1em",fill:"currentColor"},st=U("path",{d:"M320 240L160 384 0 240l0-48 320 0 0 48z"},null,-1),at=[st];function rt(N,u){return _(),S("svg",nt,at)}const _e=ie(ot,[["render",rt]]),it={class:"seventv-autocomplete-floater"},ct={key:0,class:"seventv-autocomplete-floater-list",direction:"backwards"},lt={class:"seventv-autocomplete-floater-list",direction:"current"},ut={key:1,class:"seventv-autocomplete-floater-list",direction:"forwards"},pt=K({__name:"ChatInputCarousel",props:{instance:{},currentMatch:{},backwardsMatches:{},forwardsMatches:{}},emits:["back","forward"],setup(N,{emit:u}){const v=N,A=x("chat_input.autocomplete.carousel_arrow_keys"),T=E(null),C=E(new Set),k=E(new Set),O=E(new Set);return Ie(()=>{C.value=new Set(v.backwardsMatches),k.value=new Set(v.forwardsMatches),O.value=new Set([v.currentMatch]);const b=v.instance.domNodes.root;b&&(T.value=b)}),We("keydown",b=>{A.value&&(b.key==="ArrowLeft"?u("back",b):b.key==="ArrowRight"&&u("forward",b))},{capture:!0}),(b,h)=>T.value&&b.currentMatch.item?(_(),R(Ze,{key:0,anchor:T.value,placement:"top"},{default:re(()=>[U("div",it,[C.value.size?(_(),S("div",ct,[F(_e),(_(!0),S(G,null,Q(C.value,o=>(_(),S(G,{key:o.token},[o.item?(_(),R(ae,{key:0,emote:o.item},null,8,["emote"])):L("",!0)],64))),128))])):L("",!0),U("div",lt,[(_(!0),S(G,null,Q(O.value,o=>(_(),S(G,{key:o.token},[o.item?(_(),R(ae,{key:0,emote:o.item},null,8,["emote"])):L("",!0)],64))),128))]),k.value.size?(_(),S("div",ut,[(_(!0),S(G,null,Q(k.value,o=>(_(),S(G,{key:o.token},[o.item?(_(),R(ae,{key:0,emote:o.item},null,8,["emote"])):L("",!0)],64))),128)),F(_e)])):L("",!0)])]),_:1},8,["anchor"])):L("",!0)}});const ft=ie(pt,[["__scopeId","data-v-7ec10132"]]),W=3,ht=K({__name:"ChatInput",props:{instance:{}},setup(N){var pe;const u=N,v=Ee("chat-input"),A=Be(),T=je(u.instance.component.componentRef.props.channelID,!0),C=Ke(T),k=Fe(T),O=Je(((pe=A.identity)==null?void 0:pe.id)??""),b=qe(),h=x("chat_input.autocomplete.colon"),o=x("chat_input.autocomplete.colon.emoji"),w=x("chat_input.autocomplete.chatters"),I=x("chat_input.autocomplete.carousel"),ge=x("chat_input.spam.rapid_fire_send"),ke=x("chat_input.autocomplete.colon.mode"),we=x("chat_input.autocomplete.carousel.mode"),Y=E({}),$=E(),ce=E(""),z=E(!1),J=E(),Z=E([]),ee=E(-1),{ctrl:Ce,shift:be}=He();function le(e,n="tab",i){const a=new Set,d=[],p=n==="tab"?we.value:ke.value,f=e.toLowerCase(),y=s=>({0:s.toLowerCase().startsWith(f),1:s.toLowerCase().includes(f)})[p];for(const[s,g]of Object.entries(O.emotes))a.has(s)||!y(s)||(a.add(s),d.push({token:s,priority:1,item:g}));for(const[s,g]of Object.entries(k.providers))if(s!="EMOJI")for(const[,r]of Object.entries(g))for(const c of r.emotes){const l=c.name;a.has(l)||!y(l)||(a.add(l),d.push({token:l,priority:2,item:c}))}if(n==="colon")for(const[s]of Object.entries(k.emojis))a.has(s)||!y(s)||(a.add(s),d.push({token:s,priority:4}));if(w.value&&n==="tab"){const s=f.startsWith("@"),g=f.replace("@",""),r=Object.entries(C.chatters);for(const[,c]of r)a.has(c.displayName)||!c.displayName.toLowerCase().startsWith(g)||d.push({token:(s?"@":"")+c.displayName,priority:10})}return d.sort((s,g)=>s.priority+g.priority*(s.token.localeCompare(g.token)/.5)),typeof i=="number"&&d.length>i&&(d.length=i),d}function te(e,n){var r,c;const a=u.instance.component.componentRef,d=(r=a.state)==null?void 0:r.slateEditor;if(!d)return;const p=(c=d.selection)==null?void 0:c.anchor;if(!p)return;e&&(e.preventDefault(),e.stopImmediatePropagation());let f=d;for(const l of p.path){if(!f)break;f=f.children[l]}let y=null,s=0,g=0;if(f.type=="text"&&typeof f.text=="string"){const l=f.text,m=p.offset;for(let t=m;;t--)if(t<1||l.charAt(t-1)===" "&&t!==m){s=t;break}for(let t=m+1;;t++)if(t>l.length||l.charAt(t-1)===" "){g=t-1;break}p.offset!=s&&(y=l.substring(s,g))}if(y&&y!=" "){const l=$.value;let m,t=0,M,H=[],B=[];if(!l||l.expectedPath!=p.path||l.expectedOffset!=p.offset||l.expectedWord!=y){const P=y.endsWith(" ")?y.slice(0,-1):y;M=le(P,"tab"),m=M[t]}else M=l.matches,t=n?l.index-1:l.index+1,t%=M.length,n&&t<0&&(t=M.length-1),m=M[t];if(H=M.slice(Math.max(0,t-W),t),B=M.slice(t+1,t+W+1),B.length<W&&B.push(...M.slice(0,W-B.length).filter(P=>P!==m)),H.length<W&&H.unshift(...M.slice(H.length-W).filter(P=>P!==m)),m){const P=Me(m.token,a.props.emotes)?m.token:`${m.token} `;z.value=!0,d.apply({type:"remove_text",path:p.path,offset:s,text:y}),d.apply({type:"insert_text",path:p.path,offset:s,text:P});const fe=s+P.length,he={path:p.path,offset:fe};d.apply({type:"set_selection",newProperties:{anchor:he,focus:he}}),$.value={index:t,matches:M,currentMatch:m,backwardsMatches:H,forwardsMatches:B,expectedOffset:fe,expectedPath:p.path,expectedWord:P}}else $.value=void 0}}function Me(e,n){for(const i of n)for(const a of i.emotes)if(a.token==e)return!0;return!1}function Te(){var a;const i=(a=u.instance.component.componentRef.state)==null?void 0:a.slateEditor;i&&(Z.value.unshift(i.children),Z.value.splice(9,1/0),ue())}function oe(e=!0){var y,s,g;const a=(y=u.instance.component.componentRef.state)==null?void 0:y.slateEditor;if(!a)return!1;const d=Z.value;let p=ee.value;if(e?p+=1:p-=1,p<-1||d.length<p)return!1;J.value||(J.value=a.children);let f;if(p<0?f=J.value:f=d[p],f){if(z.value=!0,e&&(((s=a.selection)==null?void 0:s.focus.offset)??0)>1)return!1;if(!e&&(((g=a.selection)==null?void 0:g.focus.offset)??0)<ce.value.length)return!1;for(const t in a.children)a.apply({type:"remove_node",path:[t],node:a.children[t]});for(const t in f)a.apply({type:"insert_node",path:[t],node:f[t]});const r=[];let c;if(f.length>0){const t=f.length-1;for(r.push(t),c=f[t];c&&c.children&&c.children.length>0;){const M=c.children.length-1;r.push(M),c=c.children[M]}}let l=0;c&&c.type=="text"&&c.text&&(l=c.text.length);const m={path:r,offset:l};return a.apply({type:"set_selection",newProperties:{anchor:m,focus:m}}),ee.value=p,!0}return!1}function ue(){ee.value=-1,J.value=void 0,$.value=void 0}function xe(e){switch(e.key){case"Tab":te(e,be.value);break;case"ArrowUp":oe(!0)&&(e.preventDefault(),e.stopImmediatePropagation());break;case"ArrowDown":oe(!1)&&(e.preventDefault(),e.stopImmediatePropagation());break}}function Se(e,n,...i){var f,y;if(!n.startsWith(":")||n.length<3||!h.value)return;const a=(e==null?void 0:e.call(this,n,...i))??[],d={...O.emotes,...k.active,...k.emojis},p=le(n.substring(1),"colon",25);for(let s=p.length-1;s>-1;s--){const g=p[s].token,r=d[g];if(!r||!o.value&&r.provider=="EMOJI")continue;const c=((f=r==null?void 0:r.data)==null?void 0:f.host)??{url:"",files:[]},l=c.srcset??Ve(c,r.provider,b.preferredFormat),m=((y=r.provider)==null?void 0:y.split("/"))??["",""];let t=(m==null?void 0:m[0])??r.provider;switch(r.scope){case"GLOBAL":t=t==null?void 0:t.concat(" Global");break;case"PERSONAL":t=t==null?void 0:t.concat(" Personal");break}a.unshift({type:"emote",current:n,element:[r.provider==="EMOJI"?{[j]:Symbol.for("react.element"),ref:null,key:`emote-icon-${r.id}`,type:"svg",props:{style:{width:"3em",height:"3em",padding:"0.5rem"},viewBox:"0 0 36 36",children:[{[j]:Symbol.for("react.element"),ref:null,key:`emote-text-${r.id}-text`,type:"use",props:{href:`#${r.id}`}}]}}:{[j]:Symbol.for("react.element"),ref:null,key:`emote-img-${r.id}`,type:"img",props:{style:{padding:"0.5rem"},srcset:l}},{[j]:Symbol.for("react.element"),ref:null,key:`emote-text-${r.id}`,type:"span",props:{children:`${r.name}`,style:{"margin-right":"0.25rem"}}},{[j]:Symbol.for("react.element"),ref:null,key:`emote-provider-${r.id}`,type:"span",props:{children:`(${t})`,class:[`brand-color-${m[0].toLowerCase()}`]}}],replacement:r.unicode??g})}return a.length>0?a:void 0}ye(()=>u.instance.domNodes.root,(e,n)=>{e!==n&&(n instanceof HTMLElement&&de(n,"ChatAutoComplete","keydown"),e instanceof HTMLElement&&Le(e,"ChatAutoComplete","keydown",xe,!0))},{immediate:!0}),se(u.instance.component,"onEditableValueUpdate",function(e,n,i,...a){return i&&(Te(),ge.value&&Ce.value&&setTimeout(()=>oe(!0),0)),z.value||ue(),z.value=!1,ce.value=n,e==null?void 0:e.call(this,n,i,...a)});const q=u.instance.component.providers.find(e=>e.autocompleteType=="mention");q&&(Y.value.mention=q,q.canBeTriggeredByTab=!1,$e(q,"props",{value(e){C.handlers.add(e.activeChattersAPI.handleMessage)}}));const ne=u.instance.component.providers.find(e=>e.autocompleteType=="emote");return ne&&(Y.value.emote=ne,se(ne,"getMatches",Se)),se(u.instance.component,"componentDidUpdate",function(...e){v!=null&&v.instance&&typeof this.props.setTray=="function"&&(v.instance.setTray=this.props.setTray,v.instance.setModifierTray=this.props.setModifierTray,v.instance.clearModifierTray=this.props.clearModifierTray);const n=e[0];return typeof n=="function"?n.call(this,...e.slice(1)):e}),ve(()=>{const e=u.instance.component;V(e,"onEditableValueUpdate"),V(e,"props"),e.componentRef&&V(e.componentRef,"props");const n=u.instance.domNodes.root;n instanceof HTMLElement&&de(n,"ChatAutoComplete","keydown");const i=Y.value;i.mention&&(i.mention.canBeTriggeredByTab=!0,V(i.mention,"props")),i.emote&&V(i.emote,"getMatches")}),(e,n)=>$.value&&$.value.currentMatch&&X(I)?(_(),R(ft,{key:0,"current-match":$.value.currentMatch,"forwards-matches":$.value.forwardsMatches??[],"backwards-matches":$.value.backwardsMatches??[],instance:e.instance,onBack:n[0]||(n[0]=i=>te(i,!0)),onForward:n[1]||(n[1]=i=>te(i,!1))},null,8,["current-match","forwards-matches","backwards-matches","instance"])):L("",!0)}}),mt={class:"seventv-super-hint"},dt={class:"seventv-super-hint-heading"},_t={class:"seventv-super-hint-content"},yt=K({__name:"UiSuperHint",props:{title:{}},setup(N){return(u,v)=>(_(),S("main",mt,[U("div",dt,[F(tt,{provider:"7TV"}),U("span",null,Qe(u.title),1)]),U("div",_t,[Pe(u.$slots,"default",{},void 0,!0)])]))}});const vt=ie(yt,[["__scopeId","data-v-7de22f02"]]),gt=U("p",null,"Would you like 7TV to let you bypass this restriction?",-1),kt=K({__name:"ChatSpam",props:{instance:{},suggest:{type:Boolean}},emits:["suggest-answer"],setup(N,{emit:u}){const v=N,A=Ae("chat"),T=Xe(v.instance.domNodes,"root"),C=et(T,{enabled:()=>v.suggest,placement:"top-start",middleware:[Ge({mainAxis:72})]}),k=De(!1,3e4);let O="";function b(h){return typeof h=="string"&&h===O?(h=h.replace(Re,""),k.value=!k.value,k.value&&(h+=" "+Ue)):k.value=!1,O=h,h}return ye(A,h=>{!h||!h.instance||h.instance.messageSendMiddleware.set("handle-dupe",b)},{immediate:!0}),ve(()=>{var h;(h=A.value)!=null&&h.instance&&A.value.instance.messageSendMiddleware.delete("handle-dupe")}),(h,o)=>h.suggest&&X(C)?(_(),R(Ne,{key:0,to:X(C)},[F(vt,{title:"Suggestion"},{default:re(()=>[F(ze,{choices:["yes","no"],onAnswer:o[0]||(o[0]=w=>u("suggest-answer",w)),onClose:o[1]||(o[1]=w=>u("suggest-answer",""))},{default:re(()=>[gt]),_:1})]),_:1})],8,["to"])):L("",!0)}});const wt=[D("chat_input.autocomplete.colon","TOGGLE",{path:["Chat","Autocompletion"],label:"Colon-completion",hint:"Allows the use of a colon (:) to open a list of partially matching emotes",defaultValue:!0}),D("chat_input.autocomplete.colon.emoji","TOGGLE",{path:["Chat","Autocompletion"],label:"Colon-completion: Emoji",disabledIf:()=>!x("chat_input.autocomplete.colon").value,hint:"Whether or not to also include emojis in the colon-completion list (This may impact performance)",defaultValue:!1}),D("chat_input.autocomplete.colon.mode","DROPDOWN",{path:["Chat","Autocompletion"],label:"Colon-completion: Mode",disabledIf:()=>!x("chat_input.autocomplete.colon").value,hint:"What emotes should be displayed in the colon-completion list",options:[["Must start with input",0],["Must include input",1]],defaultValue:1}),D("chat_input.autocomplete.carousel","TOGGLE",{path:["Chat","Autocompletion"],label:"Tab-completion Carousel",hint:"Show a carousel visualization of previous and next tab-completion matches",defaultValue:!0}),D("chat_input.autocomplete.carousel_arrow_keys","TOGGLE",{path:["Chat","Autocompletion"],label:"Tab-completion Carousel: Arrow Keys",disabledIf:()=>!x("chat_input.autocomplete.carousel").value,hint:"Whether or not to allow using left/right arrow keys to navigate the tab-completion carousel",defaultValue:!0}),D("chat_input.autocomplete.carousel.mode","DROPDOWN",{path:["Chat","Autocompletion"],label:"Tab-completion: Mode",disabledIf:()=>!x("chat_input.autocomplete.carousel").value,hint:"What emotes should be displayed in the tab-completion carousel",options:[["Must start with input",0],["Must include input",1]],defaultValue:0}),D("chat_input.autocomplete.chatters","TOGGLE",{path:["Chat","Autocompletion"],label:"Autocomplete chatters",hint:"Whether or not to consider the usernames of active chatters when using tab-completion",defaultValue:!0}),D("chat_input.spam.bypass_duplicate","TOGGLE",{path:["Chat","Typing"],label:"Bypass Duplicate Message Check",hint:"If enabled, you will be able to send the same message multiple times in a row",defaultValue:!1}),D("chat_input.spam.rapid_fire_send","TOGGLE",{path:["Chat","Typing"],label:"Quick Send",hint:"If enabled, you can use the Ctrl+Enter shortcut to keep the current message in the input box after sending",defaultValue:!0})],Ct=K({__name:"ChatInputModule",setup(N,{expose:u}){const{markAsReady:v}=Oe("chat-input",{name:"Chat Input",depends_on:[]}),A=Ye(new WeakMap),T=x("chat_input.spam.bypass_duplicate"),C=E(null),k=me({parentSelector:".chat-input__textarea",maxDepth:50,predicate:o=>o.providers},{trackRoot:!0,containerClass:"seventv-chat-input-textarea",hooks:{update(o){var w,I;A.set(o,!!((I=(w=o.component.componentRef)==null?void 0:w.props)!=null&&I.channelID))}}}),O=[{key:"message-throughput",stateKey:""},{key:"duplicated-messages",stateKey:"lastSentMessage"}];for(const o of O)me({parentSelector:".chat-input",maxDepth:20,predicate:w=>w.props.setModifierTray&&w.key===o.key},{hooks:{update(w){switch(w.component.key){case"duplicated-messages":b(w.component);break}T.value&&(o.stateKey&&(w.component.state[o.stateKey]=null),w.component.props.setModifierTray=()=>{})}}});function b(o){if(!(T.value||C.value===!1)){if(!o.props.tray||o.props.tray.type!=="duplicated-message-error"){C.value=null;return}C.value=!0}}function h(o){if(o)switch(C.value=!1,o){case"yes":T.value=!0;break;case"no":T.value=!1;break}}return u({component:k,setTray:null,setModifierTray:null,clearModifierTray:null}),v(),(o,w)=>(_(!0),S(G,null,Q(X(k).instances,I=>(_(),S(G,{key:I.identifier},[A.get(I)?(_(),R(ht,{key:0,instance:I},null,8,["instance"])):L("",!0),A.get(I)?(_(),R(kt,{key:1,instance:I,suggest:C.value||!1,onSuggestAnswer:h},null,8,["instance","suggest"])):L("",!0)],64))),128))}}),Rt=Object.freeze(Object.defineProperty({__proto__:null,config:wt,default:Ct},Symbol.toStringTag,{value:"Module"}));export{Rt as _};
