var q=Object.defineProperty;var L=(e,t,s)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var S=(e,t,s)=>(L(e,typeof t!="symbol"?t+"":t,s),s);import{a as g,l as $,a9 as b,r as N}from"./seventv.useUserAgent.3.0.9.js";import{R as k,aI as M,L as y,aC as F,Q as G}from"./seventv.index.3.0.9.js";function p(e,t,s){return Math.min(Math.max(e,s),t)}class H extends Error{constructor(t){super(`Failed to parse color: "${t}"`)}}var h=H;function A(e){if(typeof e!="string")throw new h(e);if(e.trim().toLowerCase()==="transparent")return[0,0,0,0];let t=e.trim();t=X.test(e)?Q(e):e;const s=V.exec(t);if(s){const l=Array.from(s).slice(1);return[...l.slice(0,3).map(n=>parseInt(x(n,2),16)),parseInt(x(l[3]||"f",2),16)/255]}const i=W.exec(t);if(i){const l=Array.from(i).slice(1);return[...l.slice(0,3).map(n=>parseInt(n,16)),parseInt(l[3]||"ff",16)/255]}const u=J.exec(t);if(u){const l=Array.from(u).slice(1);return[...l.slice(0,3).map(n=>parseInt(n,10)),parseFloat(l[3]||"1")]}const d=K.exec(t);if(d){const[l,n,c,a]=Array.from(d).slice(1).map(parseFloat);if(p(0,100,n)!==n)throw new h(e);if(p(0,100,c)!==c)throw new h(e);return[...Y(l,n,c),Number.isNaN(a)?1:a]}throw new h(e)}function U(e){let t=5381,s=e.length;for(;s;)t=t*33^e.charCodeAt(--s);return(t>>>0)%2341}const C=e=>parseInt(e.replace(/_/g,""),36),O="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((e,t)=>{const s=C(t.substring(0,3)),i=C(t.substring(3)).toString(16);let u="";for(let d=0;d<6-i.length;d++)u+="0";return e[s]=`${u}${i}`,e},{});function Q(e){const t=e.toLowerCase().trim(),s=O[U(t)];if(!s)throw new h(e);return`#${s}`}const x=(e,t)=>Array.from(Array(t)).map(()=>e).join(""),V=new RegExp(`^#${x("([a-f0-9])",3)}([a-f0-9])?$`,"i"),W=new RegExp(`^#${x("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),J=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${x(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),K=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,X=/^[a-z]+$/i,R=e=>Math.round(e*255),Y=(e,t,s)=>{let i=s/100;if(t===0)return[i,i,i].map(R);const u=(e%360+360)%360/60,d=(1-Math.abs(2*i-1))*(t/100),l=d*(1-Math.abs(u%2-1));let n=0,c=0,a=0;u>=0&&u<1?(n=d,c=l):u>=1&&u<2?(n=l,c=d):u>=2&&u<3?(c=d,a=l):u>=3&&u<4?(c=l,a=d):u>=4&&u<5?(n=l,a=d):u>=5&&u<6&&(n=d,a=l);const r=i-d/2,f=n+r,_=c+r,m=a+r;return[f,_,m].map(R)};function Z(e){const[t,s,i,u]=A(e).map((f,_)=>_===3?f:f/255),d=Math.max(t,s,i),l=Math.min(t,s,i),n=(d+l)/2;if(d===l)return[0,0,n,u];const c=d-l,a=n>.5?c/(2-d-l):c/(d+l);return[60*(t===d?(s-i)/c+(s<i?6:0):s===d?(i-t)/c+2:(t-s)/c+4),a,n,u]}function I(e,t,s,i){return`hsla(${(e%360).toFixed()}, ${p(0,100,t*100).toFixed()}%, ${p(0,100,s*100).toFixed()}%, ${parseFloat(p(0,1,i).toFixed(3))})`}function D(e,t){const[s,i,u,d]=Z(e);return I(s,i,u-t,d)}function T(e){if(e==="transparent")return 0;function t(d){const l=d/255;return l<=.03928?l/12.92:Math.pow((l+.055)/1.055,2.4)}const[s,i,u]=A(e);return .2126*t(s)+.7152*t(i)+.0722*t(u)}function ee(e,t){const s=T(e),i=T(t);return s>i?(s+.05)/(i+.05):(i+.05)/(s+.05)}const te={decorative:1.5,readable:3,aa:4.5,aaa:7};function B(e,t="aa",s="#fff"){return ee(e,s)<te[t]}const w=e=>{const t=e>>>24&255,s=e>>>16&255,i=e>>>8&255,u=e&255;return`rgba(${t}, ${s}, ${i}, ${(u/255).toFixed(3)})`},se=(e,t,s,i)=>e<<24|t<<16|s<<8|i,de=(e,t)=>{const s=e>>>24&255,i=e>>>16&255,u=e>>>8&255,d=e&255;return"#"+((1<<24)+(s<<16)+(i<<8)+u).toString(16).slice(1)+(t?re(d/255):"")},re=e=>{if(e>1||e<0||isNaN(e))throw Error("alpha must be between 0 and 1");return Math.ceil(255*e).toString(16).toUpperCase()},le=(e,t=1)=>{const s=parseInt((e==null?void 0:e.slice(1))??"0",16),i=s>>16&255,u=s>>8&255,d=s&255;return se(i,u,d,255*Math.min(t,1))},v={0:{},1:{}};function fe(e,t){let s=e.toLowerCase();const i=t?"#0f0e11":"#faf9fa";if(!B(s,"aa",i))return s;const u=v[t][e];if(u)return u;const d=A(s).slice(0,3);if(t&&d.every(n=>n<36))return v[t][e]="#7a7a7a","#7a7a7a";let l=0;for(;B(s,"aa",i)&&l<50;)s=D(s,.1*(t?-1:1)),l++;return v[t][e]=s,s}const o=g({cosmetics:{},sets:{},activeSets:new Set,entitlementBuffers:{"+":[],"-":[]},userBadges:{},userPaints:{},userEmoteSets:{},userEmoteMap:{},staticallyAssigned:{}});class j extends Map{constructor(){super(...arguments);S(this,"providers",new Set)}hasProvider(s){return this.providers.has(s)}set(s,i){return i.provider&&this.providers.add(i.provider),super.set(s,i)}delete(s){const i=this.get(s);return i?(this.providers.delete(i.provider),super.delete(s)):!1}clear(){this.providers.clear(),super.clear()}}let z=null;k.ready().then(async()=>{const{target:e}=G();M(()=>k.cosmetics.toArray(),n=>{o.cosmetics={};for(const c of n)o.cosmetics[c.id]||(o.cosmetics[c.id]=g(c),c.kind==="PAINT"&&P(c))}),e.addEventListener("static_cosmetics_fetched",n=>{const{badges:c,paints:a}=n.detail;for(let r of c??[]){o.cosmetics[r.id]?r=o.cosmetics[r.id]:o.cosmetics[r.id]=g(r);for(const f of r.user_ids??[])!f||o.userBadges[f]&&o.userBadges[f].has(r.id)||(t({id:"",kind:"BADGE",ref_id:r.id,user_id:f},"+"),o.staticallyAssigned[f]={});r.user_ids&&(r.user_ids.length=0)}for(let r of a??[]){o.cosmetics[r.id]?r=o.cosmetics[r.id]:o.cosmetics[r.id]=g(r);for(const f of r.user_ids??[])!f||o.userPaints[f]||(t({id:"",kind:"PAINT",ref_id:r.id,user_id:f},"+"),o.staticallyAssigned[f]={});r.user_ids&&(r.user_ids.length=0),P(r)}},{once:!0});function t(n,c){var a,r;if(o.staticallyAssigned[n.user_id]){for(const f of((a=o.userBadges[n.user_id])==null?void 0:a.values())??[])f.provider==="7TV"&&o.userBadges[n.user_id].delete(f.id);for(const f of((r=o.userPaints[n.user_id])==null?void 0:r.values())??[])o.userPaints[n.user_id].delete(f.id);delete o.staticallyAssigned[n.user_id]}o.entitlementBuffers[c].push(n),s()}function s(){z||(z=window.setTimeout(()=>{const n=o.entitlementBuffers["+"].splice(0,o.entitlementBuffers["+"].length),c=o.entitlementBuffers["-"].splice(0,o.entitlementBuffers["-"].length);for(const a of c){const r=u(a.kind);!r[a.user_id]||!r[a.user_id].has(a.ref_id)||r[a.user_id].delete(a.ref_id)}z=window.setTimeout(async()=>{for(const a of n){const r=u(a.kind);if(a.kind==="EMOTE_SET")r[a.user_id]||(r[a.user_id]=new Map),l(a.user_id,a.ref_id);else{r[a.user_id]||(r[a.user_id]=new j);const f=r[a.user_id];i(a.ref_id).then(_=>{f.has(a.ref_id)||f.hasProvider(_.provider)||f.set(a.ref_id,_)})}}},10),z=null},10))}function i(n){const c=o.cosmetics[n];return c?Promise.resolve(c):y(()=>o.cosmetics[n]).not.toBeUndefined()}function u(n){return{BADGE:o.userBadges,PAINT:o.userPaints,EMOTE_SET:o.userEmoteSets}[n]}function d(n,c){const a=N(null);return o.userEmoteMap[n]={},M(()=>k.emoteSets.where("id").equals(c).first(),r=>{var f;a.value=r,o.sets[c]=a.value,o.userEmoteMap[n]=a.value.emotes.filter(_=>{var m;return _.data&&((m=_.data.state)==null?void 0:m.includes("PERSONAL"))}).reduce((_,m)=>({..._,[m.name]:m}),{}),(f=o.userEmoteSets[n])==null||f.set(c,a.value)},{until:y(o.userEmoteMap[n]).toBeUndefined().then(()=>!0)}),a}async function l(n,c){const a=d(n,c),r=await Promise.race([y(a).not.toBeNull(),y(F(1e4)).toBeTruthy().then(()=>null)]);if(!r){delete o.userEmoteMap[n],$.warn("<Cosmetics>","Emote Set could not be found",`id=${c}`);return}o.userEmoteSets[n]||(o.userEmoteSets[n]=new Map),o.userEmoteSets[n].has(c)||o.userEmoteSets[n].set(c,r),$.debug("<Cosmetics>","Assigned Emote Set to user",`id=${c}`,`userID=${n}`)}e.addEventListener("entitlement_created",n=>{t(n.detail,"+")}),e.addEventListener("entitlement_deleted",n=>{t(n.detail,"-")}),k.entitlements.toArray().then(n=>{var c,a;for(const r of n){let f=!1;const _=!!o.staticallyAssigned[r.user_id];switch(r.kind){case"BADGE":if(!_&&((c=o.userBadges[r.user_id])!=null&&c.size))continue;t(r,"+"),f=!0;break;case"PAINT":if(!_&&((a=o.userPaints[r.user_id])!=null&&a.size))continue;t(r,"+"),f=!0;break;case"EMOTE_SET":l(r.user_id,r.ref_id);break}$.debug("<Cosmetics>","Assigned",n.length.toString(),"stored entitlements"),f&&(o.staticallyAssigned[r.user_id]={})}})});function _e(e){return o.userBadges[e]||(o.userBadges[e]=new j),o.userPaints[e]||(o.userPaints[e]=new j),o.userEmoteMap[e]||(o.userEmoteMap[e]={}),g({paints:b(o.userPaints,e),badges:b(o.userBadges,e),emotes:b(o.userEmoteMap,e),emoteSets:b(o.userEmoteSets,e)})}function me(){return o}let E=null;function ne(){if(E)return E;const e=document.createElement("link");e.type="text/css",e.rel="stylesheet";const t=document.createElement("style");return t.id="seventv-paint-styles",document.head.appendChild(t),E=t.sheet??null}function P(e,t=!1){var c,a;const s=ne();if(!s){$.error("<Cosmetics>","Could not find paint stylesheet");return}!((c=e.data.gradients)!=null&&c.length)&&e.data.function&&(e.data.gradients||(e.data.gradients=new Array(1)),e.data.gradients[0]={function:e.data.function,canvas_repeat:"",size:[1,1],shape:e.data.shape,image_url:e.data.image_url,stops:e.data.stops??[],repeat:e.data.repeat??!1,angle:e.data.angle});const i=e.data.gradients.map(r=>ie(r)),u=(()=>e.data.shadows?e.data.shadows.map(r=>oe(r)).join(" "):"")(),d=`.seventv-paint[data-seventv-paint-id="${e.id}"]`,l=`${d} {
color: ${e.data.color?w(e.data.color):"transparent"};
background-image: ${i.map(r=>r[0]).join(", ")};
background-position: ${i.map(r=>r[1]).join(", ")};
background-size: ${i.map(r=>r[2]).join(", ")};
background-repeat: ${i.map(r=>r[3]).join(", ")};
filter: ${u||"inherit"};
${e.data.text?`
font-weight: ${e.data.text.weight?e.data.text.weight*100:"inherit"};
-webkit-text-stroke-width: ${e.data.text.stroke?`${e.data.text.stroke.width}px`:"inherit"};
-webkit-text-stroke-color: ${e.data.text.stroke?w(e.data.text.stroke.color):"inherit"};
text-shadow: ${((a=e.data.text.shadows)==null?void 0:a.map(r=>`${r.x_offset}px ${r.y_offset}px ${r.radius}px ${w(r.color)}`).join(", "))??"unset"};
text-transform: ${e.data.text.transform??"unset"};
`:""}
}
`;let n=-1;for(let r=0;r<s.cssRules.length;r++){const f=s.cssRules[r];if(f instanceof CSSStyleRule&&f.selectorText===d){n=r;break}}t||(n>=0?(s.deleteRule(n),s.insertRule(l,n)):s.insertRule(l,s.cssRules.length))}function ie(e){const t=["","","",""],s=[];switch(e.function){case"LINEAR_GRADIENT":s.push(`${e.angle??0}deg`);break;case"RADIAL_GRADIENT":s.push(e.shape??"circle");break;case"URL":s.push(e.image_url??"");break}let i="";if(e.function!=="URL"){i=e.repeat?"repeating-":"";for(const u of e.stops){const d=w(u.color);s.push(`${d} ${u.at*100}%`)}}return t[0]=`${i}${e.function.toLowerCase().replace("_","-")}(${s.join(", ")})`,t[1]=e.at&&e.at.length===2?`${e.at[0]*100}% ${e.at[1]*100}%`:"",t[2]=e.size&&e.size.length===2?`${e.size[0]*100}% ${e.size[1]*100}%`:"",t[3]=e.canvas_repeat??"unset",t}function oe(e){return`drop-shadow(${e.x_offset}px ${e.y_offset}px ${e.radius}px ${w(e.color)})`}export{w as D,le as H,re as S,de as a,oe as b,ie as c,P as d,me as g,fe as n,_e as u};
